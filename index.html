<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Videos - Videos Personalizados con IA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.85) 0%, rgba(236, 72, 153, 0.85) 50%, rgba(59, 130, 246, 0.85) 100%);
            z-index: 1;
        }
        
        .video-content {
            position: relative;
            z-index: 2;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-out;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .scroll-container {
            animation: scroll 30s linear infinite;
        }

        .star-filled {
            color: #fbbf24;
        }
        
        .star-empty {
            color: #d1d5db;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ===== CONFIGURACI√ìN =====
        const SUPABASE_URL = 'https://vrhqvjsvqowsxioqusrw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyaHF2anN2cW93c3hpb3F1c3J3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjU3OTAsImV4cCI6MjA3ODYwMTc5MH0.FDSaJ-592b23kxeANFZ49vfP3skIBFv1hO5p9NSUfSE';
        const STRIPE_KEY = 'pk_test_51ST05MLwRYu46TgB8nY7XAlP9JjMTiL6sB8QwkGadNQW3JO2VNjfTUWm4IfG53oRdYYvDvzQRvaf4uBTBFb8Yyl000cjCYqRJR';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const stripe = Stripe(STRIPE_KEY);

        // ===== DATOS =====
        const personajes = [
            { 
                id: 1, 
                nombre: 'S√∫per H√©roe', 
                emoji: 'ü¶∏', 
                precio: 29.99, 
                descripcion: 'Videos de acci√≥n y aventuras heroicas llenas de emoci√≥n',
                videoDemo: 'Avatar_IV_Video.mp4',
                esNuevo: true,
                popularidad: 95
            },
            { 
                id: 2, 
                nombre: 'Princesa M√°gica', 
                emoji: 'üë∏', 
                precio: 34.99, 
                descripcion: 'Cuentos de hadas m√°gicos llenos de encanto y fantas√≠a',
                videoDemo: 'Avatar_IV_Video.mp4',
                esNuevo: false,
                popularidad: 98
            },
            { 
                id: 3, 
                nombre: 'Dinosaurio Aventurero', 
                emoji: 'ü¶ï', 
                precio: 24.99, 
                descripcion: 'Aventuras prehist√≥ricas emocionantes para los peque√±os exploradores',
                videoDemo: 'Avatar_IV_Video.mp4',
                esNuevo: true,
                popularidad: 87
            },
            { 
                id: 4, 
                nombre: 'Robot del Espacio', 
                emoji: 'ü§ñ', 
                precio: 29.99, 
                descripcion: 'Misiones espaciales incre√≠bles con tecnolog√≠a futurista',
                videoDemo: 'Avatar_IV_Video.mp4',
                esNuevo: false,
                popularidad: 92
            },
            { 
                id: 5, 
                nombre: 'Hada Encantada', 
                emoji: 'üßö', 
                precio: 32.99, 
                descripcion: 'Magia y fantas√≠a encantadora en un mundo de ensue√±o',
                videoDemo: 'Avatar_IV_Video.mp4',
                esNuevo: true,
                popularidad: 90
            },
            { 
                id: 6, 
                nombre: 'Pirata Alegre', 
                emoji: 'üè¥‚Äç‚ò†Ô∏è', 
                precio: 27.99, 
                descripcion: 'B√∫squeda de tesoros y aventuras en alta mar',
                videoDemo: 'Avatar_IV_Video.mp4',
                esNuevo: false,
                popularidad: 85
            }
        ];

        const tiposVideo = [
            { id: 'cumpleanos', nombre: 'Cumplea√±os', precio: 0 },
            { id: 'mensaje', nombre: 'Mensaje Especial', precio: 5 },
            { id: 'aventura', nombre: 'Historia de Aventura', precio: 10 }
        ];

        const duraciones = [
            { id: 'corto', nombre: '1-2 minutos', precioExtra: 0 },
            { id: 'medio', nombre: '3-4 minutos', precioExtra: 15 },
            { id: 'largo', nombre: '5+ minutos', precioExtra: 25 }
        ];

        const velocidades = [
            { id: 'estandar', nombre: 'Est√°ndar (3-5 d√≠as)', horas: 120, precioExtra: 0 },
            { id: 'rapida', nombre: 'R√°pida (1-2 d√≠as)', horas: 48, precioExtra: 20 },
            { id: 'express', nombre: 'Express (24 horas)', horas: 24, precioExtra: 40 }
        ];

        // ===== COMPONENTE PRINCIPAL =====
        function App() {
            const [usuario, setUsuario] = useState(null);
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedPersonaje, setSelectedPersonaje] = useState(null);
            const [carrito, setCarrito] = useState([]);
            const [misPedidos, setMisPedidos] = useState([]);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    if (session) {
                        setUsuario({
                            id: session.user.id,
                            nombre: session.user.user_metadata.full_name || session.user.email.split('@')[0],
                            email: session.user.email,
                            avatar: session.user.user_metadata.avatar_url
                        });
                    }
                });

                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    if (session) {
                        setUsuario({
                            id: session.user.id,
                            nombre: session.user.user_metadata.full_name || session.user.email.split('@')[0],
                            email: session.user.email,
                            avatar: session.user.user_metadata.avatar_url
                        });
                    } else {
                        setUsuario(null);
                    }
                });

                return () => subscription.unsubscribe();
            }, []);

            useEffect(() => {
                if (usuario) cargarPedidos();
            }, [usuario]);

            const cargarPedidos = async () => {
                if (!usuario?.id) return;
                try {
                    const response = await fetch(`/api/pedidos/listar?usuario_id=${usuario.id}`);
                    const data = await response.json();
                    if (data.success) setMisPedidos(data.pedidos);
                } catch (error) {
                    console.error('Error cargando pedidos:', error);
                }
            };

            const handleLogin = async () => {
                try {
                    const { error } = await supabase.auth.signInWithOAuth({
                        provider: 'google',
                        options: { redirectTo: window.location.origin }
                    });
                    if (error) throw error;
                } catch (error) {
                    alert('Error al iniciar sesi√≥n: ' + error.message);
                }
            };

            const handleLogout = async () => {
                await supabase.auth.signOut();
                setUsuario(null);
                setCarrito([]);
                setCurrentPage('home');
            };

            const agregarAlCarrito = (item) => {
                setCarrito([...carrito, item]);
                setCurrentPage('carrito');
            };

            const eliminarDelCarrito = (index) => {
                setCarrito(carrito.filter((_, i) => i !== index));
            };

            const handleCheckout = async () => {
                if (!usuario) {
                    alert('Debes iniciar sesi√≥n para continuar');
                    return;
                }
                if (carrito.length === 0) {
                    alert('El carrito est√° vac√≠o');
                    return;
                }

                try {
                    setLoading(true);
                    const response = await fetch('/api/checkout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ carrito, usuario })
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error);
                    window.location.href = data.url;
                } catch (error) {
                    alert('Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const verPersonaje = (personaje) => {
                setSelectedPersonaje(personaje);
                setCurrentPage('personaje');
            };

            // ===== HEADER =====
            const Header = () => (
                <header className="bg-white shadow-sm sticky top-0 z-40">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-20">
                            <div className="flex items-center cursor-pointer" onClick={() => setCurrentPage('home')}>
                                <img src="logo.png" alt="Magic Videos" className="h-16" />
                            </div>
                            <nav className="hidden md:flex space-x-8">
                                <button onClick={() => setCurrentPage('home')} 
                                    className="text-gray-700 hover:text-purple-600 font-medium transition">
                                    Inicio
                                </button>
                                {usuario && (
                                    <>
                                        <button onClick={() => setCurrentPage('dashboard')} 
                                            className="text-gray-700 hover:text-purple-600 font-medium transition">
                                            Mi Cuenta
                                        </button>
                                        <button onClick={() => setCurrentPage('misPedidos')} 
                                            className="text-gray-700 hover:text-purple-600 font-medium transition">
                                            Mis Pedidos
                                        </button>
                                    </>
                                )}
                            </nav>
                            <div className="flex items-center space-x-4">
                                <button onClick={() => setCurrentPage('carrito')} className="relative">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                    {carrito.length > 0 && <span className="cart-badge">{carrito.length}</span>}
                                </button>
                                {usuario ? (
                                    <div className="flex items-center space-x-3">
                                        {usuario.avatar && <img src={usuario.avatar} alt="Avatar" className="w-10 h-10 rounded-full border-2 border-purple-200" />}
                                        <div className="hidden md:block">
                                            <p className="text-sm font-semibold">{usuario.nombre}</p>
                                            <p className="text-xs text-gray-500">{usuario.email}</p>
                                        </div>
                                        <button onClick={handleLogout} 
                                            className="text-sm text-gray-500 hover:text-red-600 font-medium transition">
                                            Salir
                                        </button>
                                    </div>
                                ) : (
                                    <button onClick={handleLogin} 
                                        className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transition font-semibold">
                                        Iniciar Sesi√≥n
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                </header>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    <Header />
                    <main>
                        {currentPage === 'home' && <HomePage verPersonaje={verPersonaje} />}
                        {currentPage === 'personaje' && <PersonajePage personaje={selectedPersonaje} agregarAlCarrito={agregarAlCarrito} usuario={usuario} />}
                        {currentPage === 'dashboard' && <DashboardPage usuario={usuario} pedidos={misPedidos} setCurrentPage={setCurrentPage} />}
                        {currentPage === 'carrito' && <CarritoPage carrito={carrito} eliminarDelCarrito={eliminarDelCarrito} handleCheckout={handleCheckout} loading={loading} setCurrentPage={setCurrentPage} />}
                        {currentPage === 'misPedidos' && <MisPedidosPage pedidos={misPedidos} usuario={usuario} />}
                    </main>
                </div>
            );
        }

        // ===== HOME PAGE =====
        function HomePage({ verPersonaje }) {
            const personajesNuevos = personajes.filter(p => p.esNuevo);
            const personajesPopulares = [...personajes].sort((a, b) => b.popularidad - a.popularidad).slice(0, 3);

            return (
                <div>
                    {/* Hero */}
                    <section className="relative h-screen flex items-center justify-center overflow-hidden">
                        <video autoPlay loop muted playsInline className="video-background">
                            <source src="Avatar_IV_Video.mp4" type="video/mp4" />
                        </video>
                        <div className="video-overlay"></div>
                        <div className="video-content text-center px-4 fade-in">
                            <h1 className="text-5xl md:text-7xl font-bold text-white mb-6">
                                Videos M√°gicos Para<br />Momentos Especiales
                            </h1>
                            <p className="text-xl md:text-2xl text-white mb-8 max-w-2xl mx-auto">
                                Videos personalizados √∫nicos con tus personajes favoritos
                            </p>
                            <button onClick={() => window.scrollTo({ top: window.innerHeight, behavior: 'smooth' })} 
                                className="bg-white text-purple-600 px-8 py-4 rounded-full text-lg font-bold hover:scale-110 transform transition shadow-2xl">
                                Explorar Personajes ‚ú®
                            </button>
                            <div className="mt-12 flex justify-center space-x-8 text-white">
                                <div className="text-center">
                                    <div className="text-4xl font-bold">1000+</div>
                                    <div className="text-sm">Videos Creados</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-4xl font-bold">4.9/5</div>
                                    <div className="text-sm">Calificaci√≥n</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-4xl font-bold">99%</div>
                                    <div className="text-sm">Satisfacci√≥n</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Nuevos */}
                    <section className="py-16 px-4 bg-white">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex justify-between items-center mb-10">
                                <h2 className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                    ‚ú® Personajes Nuevos
                                </h2>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                {personajesNuevos.map(personaje => (
                                    <PersonajeCard key={personaje.id} personaje={personaje} onClick={() => verPersonaje(personaje)} />
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* M√°s Comprados */}
                    <section className="py-16 px-4 bg-gradient-to-r from-purple-50 to-pink-50">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex justify-between items-center mb-10">
                                <h2 className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                    üî• M√°s Comprados
                                </h2>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                {personajesPopulares.map(personaje => (
                                    <PersonajeCard key={personaje.id} personaje={personaje} onClick={() => verPersonaje(personaje)} esPopular />
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* Todos */}
                    <section className="py-16 px-4 bg-white">
                        <div className="max-w-7xl mx-auto">
                            <h2 className="text-4xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                Todos los Personajes
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                {personajes.map(personaje => (
                                    <PersonajeCard key={personaje.id} personaje={personaje} onClick={() => verPersonaje(personaje)} />
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* C√≥mo Funciona */}
                    <section className="py-20 px-4 bg-gradient-to-r from-purple-600 to-pink-600">
                        <div className="max-w-7xl mx-auto">
                            <h2 className="text-4xl font-bold text-center mb-12 text-white">
                                ¬øC√≥mo Funciona?
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-8 text-white">
                                <div className="text-center">
                                    <div className="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <span className="text-4xl">1Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Elige Personaje</h3>
                                    <p className="text-white/90">Selecciona tu favorito</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <span className="text-4xl">2Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Personaliza</h3>
                                    <p className="text-white/90">Escribe tu mensaje</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <span className="text-4xl">3Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Paga Seguro</h3>
                                    <p className="text-white/90">Con Stripe</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <span className="text-4xl">4Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Recibe Video</h3>
                                    <p className="text-white/90">En 24-72 horas</p>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            );
        }

        // ===== PERSONAJE CARD =====
        function PersonajeCard({ personaje, onClick, esPopular }) {
            return (
                <div onClick={onClick}
                    className="bg-white rounded-3xl p-8 shadow-xl hover:shadow-2xl transition cursor-pointer transform hover:scale-105 relative">
                    {personaje.esNuevo && !esPopular && (
                        <span className="absolute top-4 right-4 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">
                            NUEVO
                        </span>
                    )}
                    {esPopular && (
                        <span className="absolute top-4 right-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">
                            üî• POPULAR
                        </span>
                    )}
                    <div className="text-7xl text-center mb-4">{personaje.emoji}</div>
                    <h3 className="text-2xl font-bold text-center mb-3">{personaje.nombre}</h3>
                    <p className="text-gray-600 text-center mb-6 text-sm">{personaje.descripcion}</p>
                    <div className="text-center">
                        <span className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                            ${personaje.precio}
                        </span>
                    </div>
                    <button className="w-full mt-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transition">
                        Ver Detalles ‚Üí
                    </button>
                </div>
            );
        }

        // ===== P√ÅGINA DE PERSONAJE =====
        function PersonajePage({ personaje, agregarAlCarrito, usuario }) {
            const [tipoVideo, setTipoVideo] = useState(tiposVideo[0]);
            const [duracion, setDuracion] = useState(duraciones[0]);
            const [velocidad, setVelocidad] = useState(velocidades[0]);
            const [mensaje, setMensaje] = useState('');

            if (!personaje) return null;

            const precioTotal = personaje.precio + tipoVideo.precio + duracion.precioExtra + velocidad.precioExtra;

            const handleAgregar = () => {
                if (!mensaje.trim()) {
                    alert('Por favor escribe un mensaje');
                    return;
                }
                agregarAlCarrito({
                    personaje,
                    tipoVideo,
                    duracion,
                    velocidadEntrega: velocidad,
                    mensaje,
                    precioBase: personaje.precio,
                    precioTotal
                });
            };

            return (
                <div className="max-w-7xl mx-auto px-4 py-12">
                    <div className="grid md:grid-cols-2 gap-12">
                        {/* Video Demo */}
                        <div>
                            <div className="bg-black rounded-3xl overflow-hidden shadow-2xl mb-6">
                                <video controls className="w-full">
                                    <source src={personaje.videoDemo} type="video/mp4" />
                                </video>
                            </div>
                            <div className="bg-white rounded-2xl p-6 shadow-lg">
                                <div className="flex items-center justify-between mb-4">
                                    <h1 className="text-4xl font-bold">{personaje.emoji} {personaje.nombre}</h1>
                                    <span className="text-3xl font-bold text-purple-600">${personaje.precio}</span>
                                </div>
                                <p className="text-gray-600 mb-6">{personaje.descripcion}</p>
                                <div className="flex items-center space-x-4">
                                    <div className="flex items-center">
                                        {[...Array(5)].map((_, i) => (
                                            <span key={i} className="text-2xl star-filled">‚òÖ</span>
                                        ))}
                                    </div>
                                    <span className="text-gray-600">(4.9/5 - 127 reviews)</span>
                                </div>
                            </div>
                        </div>

                        {/* Personalizaci√≥n */}
                        <div className="bg-white rounded-3xl p-8 shadow-xl">
                            <h2 className="text-3xl font-bold mb-8">Personaliza Tu Video</h2>
                            
                            {/* Tipo */}
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">Tipo de Video</h3>
                                <div className="grid grid-cols-3 gap-4">
                                    {tiposVideo.map(t => (
                                        <button key={t.id} onClick={() => setTipoVideo(t)}
                                            className={`p-4 rounded-xl border-2 transition ${
                                                tipoVideo.id === t.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200 hover:border-purple-300'
                                            }`}>
                                            <p className="font-semibold text-sm">{t.nombre}</p>
                                            <p className="text-purple-600 font-bold text-sm">+${t.precio}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Duraci√≥n */}
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">Duraci√≥n</h3>
                                <div className="grid grid-cols-3 gap-4">
                                    {duraciones.map(d => (
                                        <button key={d.id} onClick={() => setDuracion(d)}
                                            className={`p-4 rounded-xl border-2 transition ${
                                                duracion.id === d.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200'
                                            }`}>
                                            <p className="font-semibold text-sm">{d.nombre}</p>
                                            <p className="text-purple-600 font-bold">+${d.precioExtra}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Velocidad */}
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">Velocidad de Entrega</h3>
                                <div className="space-y-3">
                                    {velocidades.map(v => (
                                        <button key={v.id} onClick={() => setVelocidad(v)}
                                            className={`w-full p-4 rounded-xl border-2 transition text-left ${
                                                velocidad.id === v.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200'
                                            }`}>
                                            <div className="flex justify-between items-center">
                                                <span className="font-semibold">{v.nombre}</span>
                                                <span className="text-purple-600 font-bold">+${v.precioExtra}</span>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Mensaje */}
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">Tu Mensaje Personalizado</h3>
                                <textarea value={mensaje} onChange={(e) => setMensaje(e.target.value)}
                                    className="w-full p-4 border-2 border-gray-200 rounded-xl resize-none focus:border-purple-600 focus:outline-none"
                                    rows="6" placeholder="Escribe aqu√≠ tu mensaje especial..."
                                />
                            </div>

                            {/* Total */}
                            <div className="border-t-2 pt-6">
                                <div className="flex justify-between items-center mb-6">
                                    <span className="text-gray-600 text-lg">Total:</span>
                                    <span className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                        ${precioTotal.toFixed(2)}
                                    </span>
                                </div>
                                <button onClick={handleAgregar}
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-xl font-bold hover:scale-105 transition shadow-xl">
                                    Agregar al Carrito üõí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== DASHBOARD =====
        function DashboardPage({ usuario, pedidos, setCurrentPage }) {
            if (!usuario) {
                return (
                    <div className="text-center py-20">
                        <p className="text-xl">Inicia sesi√≥n para ver tu dashboard</p>
                    </div>
                );
            }

            const pedidosCompletados = pedidos.filter(p => p.estado === 'completado').length;
            const pedidosEnProceso = pedidos.filter(p => ['pagado', 'en_proceso', 'en_edicion'].includes(p.estado)).length;

            return (
                <div className="max-w-7xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold mb-8">Mi Cuenta</h1>
                    
                    <div className="grid md:grid-cols-3 gap-6 mb-12">
                        {/* Card Pedidos */}
                        <div className="bg-gradient-to-r from-purple-600 to-pink-600 rounded-3xl p-8 text-white shadow-xl cursor-pointer hover:scale-105 transition"
                            onClick={() => setCurrentPage('misPedidos')}>
                            <div className="text-5xl mb-4">üì¶</div>
                            <h2 className="text-3xl font-bold mb-2">{pedidos.length}</h2>
                            <p className="text-white/80">Total de Pedidos</p>
                        </div>

                        {/* Card Videos Recibidos */}
                        <div className="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-3xl p-8 text-white shadow-xl cursor-pointer hover:scale-105 transition">
                            <div className="text-5xl mb-4">üé¨</div>
                            <h2 className="text-3xl font-bold mb-2">{pedidosCompletados}</h2>
                            <p className="text-white/80">Videos Recibidos</p>
                        </div>

                        {/* Card Cupones */}
                        <div className="bg-gradient-to-r from-green-600 to-emerald-600 rounded-3xl p-8 text-white shadow-xl cursor-pointer hover:scale-105 transition">
                            <div className="text-5xl mb-4">üéüÔ∏è</div>
                            <h2 className="text-3xl font-bold mb-2">0</h2>
                            <p className="text-white/80">Cupones Disponibles</p>
                        </div>
                    </div>

                    {/* Info Usuario */}
                    <div className="bg-white rounded-3xl p-8 shadow-xl mb-8">
                        <h2 className="text-2xl font-bold mb-6">Informaci√≥n Personal</h2>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div>
                                <p className="text-gray-600 mb-2">Nombre</p>
                                <p className="text-xl font-semibold">{usuario.nombre}</p>
                            </div>
                            <div>
                                <p className="text-gray-600 mb-2">Email</p>
                                <p className="text-xl font-semibold">{usuario.email}</p>
                            </div>
                        </div>
                    </div>

                    {/* Pedidos en Proceso */}
                    {pedidosEnProceso > 0 && (
                        <div className="bg-white rounded-3xl p-8 shadow-xl">
                            <h2 className="text-2xl font-bold mb-6">Pedidos en Proceso</h2>
                            <div className="space-y-4">
                                {pedidos.filter(p => ['pagado', 'en_proceso', 'en_edicion'].includes(p.estado)).map(pedido => (
                                    <div key={pedido.id} className="border-2 border-purple-200 rounded-2xl p-6">
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <h3 className="text-xl font-bold mb-2">{pedido.personaje_nombre}</h3>
                                                <p className="text-gray-600 text-sm">{pedido.mensaje_personalizado}</p>
                                            </div>
                                            <span className="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-bold">
                                                {pedido.estado}
                                            </span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-4">
                                            <div className="bg-gradient-to-r from-purple-600 to-pink-600 h-4 rounded-full"
                                                style={{width: `${pedido.progreso}%`}}>
                                            </div>
                                        </div>
                                        <p className="text-center text-sm text-gray-600 mt-2">{pedido.progreso}% completado</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ===== CARRITO =====
        function CarritoPage({ carrito, eliminarDelCarrito, handleCheckout, loading, setCurrentPage }) {
            const total = carrito.reduce((sum, item) => sum + item.precioTotal, 0);

            if (carrito.length === 0) {
                return (
                    <div className="text-center py-20">
                        <div className="text-8xl mb-6">üõí</div>
                        <h2 className="text-3xl font-bold mb-4">Tu carrito est√° vac√≠o</h2>
                        <button onClick={() => setCurrentPage('home')} 
                            className="mt-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-full font-bold hover:scale-105 transition">
                            Ver Personajes
                        </button>
                    </div>
                );
            }

            return (
                <div className="max-w-5xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold mb-8">Tu Carrito</h1>
                    <div className="bg-white rounded-3xl p-8 shadow-xl">
                        {carrito.map((item, i) => (
                            <div key={i} className="border-b-2 pb-6 mb-6 last:border-0">
                                <div className="flex justify-between">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-3 mb-3">
                                            <span className="text-4xl">{item.personaje.emoji}</span>
                                            <h3 className="text-2xl font-bold">{item.personaje.nombre}</h3>
                                        </div>
                                        <p className="text-gray-600 mb-2">‚Ä¢ Tipo: {item.tipoVideo.nombre}</p>
                                        <p className="text-gray-600 mb-2">‚Ä¢ Duraci√≥n: {item.duracion.nombre}</p>
                                        <p className="text-gray-600 mb-2">‚Ä¢ Entrega: {item.velocidadEntrega.nombre}</p>
                                        <p className="text-gray-500 italic mt-3">"{item.mensaje}"</p>
                                    </div>
                                    <div className="text-right ml-6">
                                        <p className="text-3xl font-bold text-purple-600 mb-3">${item.precioTotal.toFixed(2)}</p>
                                        <button onClick={() => eliminarDelCarrito(i)} 
                                            className="text-red-600 hover:text-red-800 font-semibold transition">
                                            Eliminar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        <div className="border-t-2 pt-8 space-y-6">
                            {/* TODO: Cup√≥n de descuento - FASE 2 */}
                            <div className="bg-gray-50 rounded-xl p-4">
                                <p className="text-sm text-gray-600 mb-2">¬øTienes un cup√≥n de descuento?</p>
                                <div className="flex gap-2">
                                    <input type="text" placeholder="C√≥digo de cup√≥n" 
                                        className="flex-1 px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-600 focus:outline-none"
                                        disabled />
                                    <button className="px-6 py-2 bg-gray-300 text-gray-500 rounded-lg font-semibold cursor-not-allowed">
                                        Aplicar
                                    </button>
                                </div>
                                <p className="text-xs text-gray-500 mt-2">Pr√≥ximamente disponible</p>
                            </div>

                            <div className="flex justify-between items-center">
                                <div>
                                    <p className="text-gray-600 mb-2">Total:</p>
                                    <p className="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                        ${total.toFixed(2)}
                                    </p>
                                </div>
                                <button onClick={handleCheckout} disabled={loading}
                                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-5 rounded-full text-xl font-bold hover:scale-105 transition disabled:opacity-50 shadow-xl">
                                    {loading ? 'Procesando...' : 'Pagar con Stripe üí≥'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== MIS PEDIDOS =====
        function MisPedidosPage({ pedidos, usuario }) {
            if (!usuario) {
                return (
                    <div className="text-center py-20">
                        <p className="text-xl">Inicia sesi√≥n para ver tus pedidos</p>
                    </div>
                );
            }

            if (pedidos.length === 0) {
                return (
                    <div className="text-center py-20">
                        <div className="text-8xl mb-6">üì¶</div>
                        <h2 className="text-3xl font-bold mb-4">No tienes pedidos a√∫n</h2>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold mb-8">Mis Pedidos</h1>
                    <div className="space-y-6">
                        {pedidos.map(pedido => (
                            <div key={pedido.id} className="bg-white rounded-3xl p-8 shadow-xl">
                                <div className="flex justify-between mb-6">
                                    <div>
                                        <h3 className="text-2xl font-bold mb-2">{pedido.personaje_nombre}</h3>
                                        <p className="text-gray-600">{pedido.mensaje_personalizado}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-3xl font-bold text-purple-600">${pedido.precio_total}</p>
                                        <span className={`inline-block px-4 py-2 rounded-full text-sm font-bold mt-2 ${
                                            pedido.estado === 'completado' ? 'bg-green-100 text-green-800' :
                                            pedido.estado === 'pagado' ? 'bg-blue-100 text-blue-800' :
                                            'bg-yellow-100 text-yellow-800'
                                        }`}>
                                            {pedido.estado.toUpperCase()}
                                        </span>
                                    </div>
                                </div>
                                
                                <div className="w-full bg-gray-200 rounded-full h-6 mb-2">
                                    <div className="bg-gradient-to-r from-purple-600 to-pink-600 h-6 rounded-full transition-all flex items-center justify-center text-white text-sm font-bold"
                                        style={{width: `${pedido.progreso}%`}}>
                                        {pedido.progreso}%
                                    </div>
                                </div>
                                
                                {pedido.video_url && (
                                    <div className="mt-6 pt-6 border-t-2">
                                        <a href={pedido.video_url} target="_blank" rel="noopener noreferrer"
                                            className="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-full font-bold hover:scale-105 transition shadow-xl">
                                            Ver Mi Video üé¨
                                        </a>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
