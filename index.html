<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Videos - Videos Personalizados con IA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CDNs para funcionalidad real -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.85) 0%, rgba(236, 72, 153, 0.85) 50%, rgba(59, 130, 246, 0.85) 100%);
            z-index: 1;
        }
        
        .video-content {
            position: relative;
            z-index: 2;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-out;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .scroll-container {
            animation: scroll 30s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ===== CONFIGURACI√ìN BACKEND =====
        const SUPABASE_URL = 'https://vrhqvjsvqowsxioqusrw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyaHF2anN2cW93c3hpb3F1c3J3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjU3OTAsImV4cCI6MjA3ODYwMTc5MH0.FDSaJ-592b23kxeANFZ49vfP3skIBFv1hO5p9NSUfSE';
        const STRIPE_KEY = 'pk_test_51ST05MLwRYu46TgB8nY7XAlP9JjMTiL6sB8QwkGadNQW3JO2VNjfTUWm4IfG53oRdYYvDvzQRvaf4uBTBFb8Yyl000cjCYqRJR';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const stripe = Stripe(STRIPE_KEY);

        // ===== DATOS =====
        const personajes = [
            { id: 1, nombre: 'S√∫per H√©roe', emoji: 'ü¶∏', precio: 29.99, descripcion: 'Videos de acci√≥n y aventuras heroicas' },
            { id: 2, nombre: 'Princesa M√°gica', emoji: 'üë∏', precio: 34.99, descripcion: 'Cuentos de hadas y magia' },
            { id: 3, nombre: 'Dinosaurio Aventurero', emoji: 'ü¶ï', precio: 24.99, descripcion: 'Aventuras prehist√≥ricas emocionantes' },
            { id: 4, nombre: 'Robot del Espacio', emoji: 'ü§ñ', precio: 29.99, descripcion: 'Misiones espaciales y tecnolog√≠a' },
            { id: 5, nombre: 'Hada Encantada', emoji: 'üßö', precio: 32.99, descripcion: 'Magia y fantas√≠a encantadora' },
            { id: 6, nombre: 'Pirata Alegre', emoji: 'üè¥‚Äç‚ò†Ô∏è', precio: 27.99, descripcion: 'B√∫squeda de tesoros y aventuras' }
        ];

        const tiposVideo = [
            { id: 'cumpleanos', nombre: 'Cumplea√±os', precio: 0 },
            { id: 'mensaje', nombre: 'Mensaje Especial', precio: 5 },
            { id: 'aventura', nombre: 'Historia de Aventura', precio: 10 }
        ];

        const duraciones = [
            { id: 'corto', nombre: '1-2 minutos', precioExtra: 0 },
            { id: 'medio', nombre: '3-4 minutos', precioExtra: 15 },
            { id: 'largo', nombre: '5+ minutos', precioExtra: 25 }
        ];

        const velocidades = [
            { id: 'estandar', nombre: 'Est√°ndar (3-5 d√≠as)', horas: 120, precioExtra: 0 },
            { id: 'rapida', nombre: 'R√°pida (1-2 d√≠as)', horas: 48, precioExtra: 20 },
            { id: 'express', nombre: 'Express (24 horas)', horas: 24, precioExtra: 40 }
        ];

        // ===== COMPONENTE PRINCIPAL =====
        function App() {
            const [usuario, setUsuario] = useState(null);
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedPersonaje, setSelectedPersonaje] = useState(null);
            const [carrito, setCarrito] = useState([]);
            const [misPedidos, setMisPedidos] = useState([]);
            const [loading, setLoading] = useState(false);

            // Autenticaci√≥n
            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    if (session) {
                        setUsuario({
                            id: session.user.id,
                            nombre: session.user.user_metadata.full_name || session.user.email.split('@')[0],
                            email: session.user.email,
                            avatar: session.user.user_metadata.avatar_url
                        });
                    }
                });

                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    if (session) {
                        setUsuario({
                            id: session.user.id,
                            nombre: session.user.user_metadata.full_name || session.user.email.split('@')[0],
                            email: session.user.email,
                            avatar: session.user.user_metadata.avatar_url
                        });
                    } else {
                        setUsuario(null);
                    }
                });

                return () => subscription.unsubscribe();
            }, []);

            // Cargar pedidos
            useEffect(() => {
                if (usuario) cargarPedidos();
            }, [usuario]);

            const cargarPedidos = async () => {
                if (!usuario?.id) return;
                try {
                    const response = await fetch(`/api/pedidos/listar?usuario_id=${usuario.id}`);
                    const data = await response.json();
                    if (data.success) setMisPedidos(data.pedidos);
                } catch (error) {
                    console.error('Error cargando pedidos:', error);
                }
            };

            const handleLogin = async () => {
                try {
                    const { error } = await supabase.auth.signInWithOAuth({
                        provider: 'google',
                        options: { redirectTo: window.location.origin }
                    });
                    if (error) throw error;
                } catch (error) {
                    alert('Error al iniciar sesi√≥n: ' + error.message);
                }
            };

            const handleLogout = async () => {
                await supabase.auth.signOut();
                setUsuario(null);
                setCarrito([]);
                setCurrentPage('home');
            };

            const agregarAlCarrito = (item) => {
                setCarrito([...carrito, item]);
                setCurrentPage('carrito');
            };

            const eliminarDelCarrito = (index) => {
                setCarrito(carrito.filter((_, i) => i !== index));
            };

            const handleCheckout = async () => {
                if (!usuario) {
                    alert('Debes iniciar sesi√≥n para continuar');
                    return;
                }
                if (carrito.length === 0) {
                    alert('El carrito est√° vac√≠o');
                    return;
                }

                try {
                    setLoading(true);
                    const response = await fetch('/api/checkout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ carrito, usuario })
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error);
                    window.location.href = data.url;
                } catch (error) {
                    alert('Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            // ===== HEADER =====
            const Header = () => (
                <header className="bg-white shadow-sm sticky top-0 z-40">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-16">
                            <div className="flex items-center cursor-pointer" onClick={() => setCurrentPage('home')}>
                                <img src="logo.png" alt="Magic Videos" className="h-10" />
                            </div>
                            <nav className="hidden md:flex space-x-8">
                                <button onClick={() => setCurrentPage('home')} className="text-gray-700 hover:text-purple-600">Inicio</button>
                                {usuario && (
                                    <button onClick={() => setCurrentPage('misPedidos')} className="text-gray-700 hover:text-purple-600">
                                        Mis Pedidos
                                    </button>
                                )}
                            </nav>
                            <div className="flex items-center space-x-4">
                                <button onClick={() => setCurrentPage('carrito')} className="relative">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                    {carrito.length > 0 && <span className="cart-badge">{carrito.length}</span>}
                                </button>
                                {usuario ? (
                                    <div className="flex items-center space-x-3">
                                        {usuario.avatar && <img src={usuario.avatar} alt="Avatar" className="w-8 h-8 rounded-full" />}
                                        <span className="text-sm font-medium">{usuario.nombre}</span>
                                        <button onClick={handleLogout} className="text-sm text-gray-500 hover:text-red-600">Salir</button>
                                    </div>
                                ) : (
                                    <button onClick={handleLogin} className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-lg hover:shadow-lg transition">
                                        Iniciar Sesi√≥n
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                </header>
            );

            // ===== CONTENIDO =====
            return (
                <div className="min-h-screen bg-gray-50">
                    <Header />
                    <main>
                        {currentPage === 'home' && <HomePage setCurrentPage={setCurrentPage} setSelectedPersonaje={setSelectedPersonaje} />}
                        {currentPage === 'personalizacion' && <PersonalizacionPage selectedPersonaje={selectedPersonaje} agregarAlCarrito={agregarAlCarrito} usuario={usuario} />}
                        {currentPage === 'carrito' && <CarritoPage carrito={carrito} eliminarDelCarrito={eliminarDelCarrito} handleCheckout={handleCheckout} loading={loading} setCurrentPage={setCurrentPage} />}
                        {currentPage === 'misPedidos' && <MisPedidosPage pedidos={misPedidos} usuario={usuario} />}
                    </main>
                </div>
            );
        }

        // ===== P√ÅGINA INICIO =====
        function HomePage({ setCurrentPage, setSelectedPersonaje }) {
            return (
                <div>
                    {/* Hero con video */}
                    <section className="relative h-screen flex items-center justify-center overflow-hidden">
                        <video autoPlay loop muted playsInline className="video-background">
                            <source src="Avatar_IV_Video.mp4" type="video/mp4" />
                        </video>
                        <div className="video-overlay"></div>
                        <div className="video-content text-center px-4 fade-in">
                            <h1 className="text-5xl md:text-7xl font-bold text-white mb-6">
                                Videos M√°gicos Para<br />Momentos Especiales
                            </h1>
                            <p className="text-xl md:text-2xl text-white mb-8 max-w-2xl mx-auto">
                                Videos personalizados √∫nicos con tus personajes favoritos, hechos con IA de √∫ltima generaci√≥n
                            </p>
                            <button onClick={() => setCurrentPage('personalizacion')} 
                                className="bg-white text-purple-600 px-8 py-4 rounded-full text-lg font-bold hover:scale-110 transform transition shadow-2xl">
                                Crear Mi Video ‚ú®
                            </button>
                            <div className="mt-12 flex justify-center space-x-8 text-white">
                                <div className="text-center">
                                    <div className="text-4xl font-bold">1000+</div>
                                    <div className="text-sm">Videos Creados</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-4xl font-bold">4.9/5</div>
                                    <div className="text-sm">Calificaci√≥n</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-4xl font-bold">99%</div>
                                    <div className="text-sm">Clientes Satisfechos</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Personajes */}
                    <section className="py-20 px-4">
                        <div className="max-w-7xl mx-auto">
                            <h2 className="text-4xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                Elige Tu Personaje Favorito
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                {personajes.map(personaje => (
                                    <div key={personaje.id} 
                                        onClick={() => { setSelectedPersonaje(personaje); setCurrentPage('personalizacion'); }}
                                        className="bg-white rounded-3xl p-8 shadow-xl hover:shadow-2xl transition cursor-pointer transform hover:scale-105">
                                        <div className="text-7xl text-center mb-4">{personaje.emoji}</div>
                                        <h3 className="text-2xl font-bold text-center mb-3">{personaje.nombre}</h3>
                                        <p className="text-gray-600 text-center mb-6">{personaje.descripcion}</p>
                                        <div className="text-center">
                                            <span className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                                ${personaje.precio}
                                            </span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* C√≥mo Funciona */}
                    <section className="py-20 px-4 bg-gradient-to-r from-purple-50 to-pink-50">
                        <div className="max-w-7xl mx-auto">
                            <h2 className="text-4xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                ¬øC√≥mo Funciona?
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                                <div className="text-center">
                                    <div className="bg-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                        <span className="text-4xl">1Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Elige Personaje</h3>
                                    <p className="text-gray-600">Selecciona tu personaje favorito de nuestra colecci√≥n</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                        <span className="text-4xl">2Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Personaliza</h3>
                                    <p className="text-gray-600">Escribe tu mensaje especial y elige opciones</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                        <span className="text-4xl">3Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Paga Seguro</h3>
                                    <p className="text-gray-600">Pago 100% seguro con Stripe</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                        <span className="text-4xl">4Ô∏è‚É£</span>
                                    </div>
                                    <h3 className="text-xl font-bold mb-3">Recibe Tu Video</h3>
                                    <p className="text-gray-600">En 24-72 horas recibir√°s tu video √∫nico</p>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            );
        }

        // ===== P√ÅGINA PERSONALIZACI√ìN =====
        function PersonalizacionPage({ selectedPersonaje, agregarAlCarrito, usuario }) {
            const [personaje, setPersonaje] = useState(selectedPersonaje || personajes[0]);
            const [tipoVideo, setTipoVideo] = useState(tiposVideo[0]);
            const [duracion, setDuracion] = useState(duraciones[0]);
            const [velocidad, setVelocidad] = useState(velocidades[0]);
            const [mensaje, setMensaje] = useState('');

            const precioTotal = personaje.precio + tipoVideo.precio + duracion.precioExtra + velocidad.precioExtra;

            const handleAgregar = () => {
                if (!mensaje.trim()) {
                    alert('Por favor escribe un mensaje');
                    return;
                }
                agregarAlCarrito({
                    personaje,
                    tipoVideo,
                    duracion,
                    velocidadEntrega: velocidad,
                    mensaje,
                    precioBase: personaje.precio,
                    precioTotal
                });
            };

            return (
                <div className="max-w-6xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold text-center mb-12">Personaliza Tu Video</h1>
                    <div className="bg-white rounded-3xl p-8 shadow-xl space-y-10">
                        
                        {/* Personaje */}
                        <div>
                            <h2 className="text-2xl font-bold mb-6">1. Selecciona Personaje</h2>
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                {personajes.map(p => (
                                    <div key={p.id} onClick={() => setPersonaje(p)}
                                        className={`p-4 rounded-2xl border-2 cursor-pointer transition ${
                                            personaje.id === p.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200 hover:border-purple-300'
                                        }`}>
                                        <div className="text-4xl text-center mb-2">{p.emoji}</div>
                                        <p className="text-xs font-semibold text-center">{p.nombre}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Tipo */}
                        <div>
                            <h2 className="text-2xl font-bold mb-6">2. Tipo de Video</h2>
                            <div className="grid grid-cols-3 gap-4">
                                {tiposVideo.map(t => (
                                    <div key={t.id} onClick={() => setTipoVideo(t)}
                                        className={`p-6 rounded-2xl border-2 cursor-pointer transition ${
                                            tipoVideo.id === t.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200'
                                        }`}>
                                        <p className="font-semibold mb-2">{t.nombre}</p>
                                        <p className="text-purple-600 font-bold">+${t.precio}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Duraci√≥n */}
                        <div>
                            <h2 className="text-2xl font-bold mb-6">3. Duraci√≥n</h2>
                            <div className="grid grid-cols-3 gap-4">
                                {duraciones.map(d => (
                                    <div key={d.id} onClick={() => setDuracion(d)}
                                        className={`p-6 rounded-2xl border-2 cursor-pointer ${
                                            duracion.id === d.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200'
                                        }`}>
                                        <p className="font-semibold mb-2">{d.nombre}</p>
                                        <p className="text-purple-600 font-bold">+${d.precioExtra}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Velocidad */}
                        <div>
                            <h2 className="text-2xl font-bold mb-6">4. Velocidad de Entrega</h2>
                            <div className="grid grid-cols-3 gap-4">
                                {velocidades.map(v => (
                                    <div key={v.id} onClick={() => setVelocidad(v)}
                                        className={`p-6 rounded-2xl border-2 cursor-pointer ${
                                            velocidad.id === v.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200'
                                        }`}>
                                        <p className="font-semibold mb-2">{v.nombre}</p>
                                        <p className="text-purple-600 font-bold">+${v.precioExtra}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Mensaje */}
                        <div>
                            <h2 className="text-2xl font-bold mb-6">5. Tu Mensaje Personalizado</h2>
                            <textarea value={mensaje} onChange={(e) => setMensaje(e.target.value)}
                                className="w-full p-6 border-2 border-gray-200 rounded-2xl resize-none focus:border-purple-600 focus:outline-none"
                                rows="6" placeholder="Escribe aqu√≠ tu mensaje especial..."
                            />
                        </div>

                        {/* Total */}
                        <div className="border-t-2 pt-8 flex justify-between items-center">
                            <div>
                                <p className="text-gray-600 mb-2">Precio Total:</p>
                                <p className="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                    ${precioTotal.toFixed(2)}
                                </p>
                            </div>
                            <button onClick={handleAgregar}
                                className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-5 rounded-full text-xl font-bold hover:scale-105 transition shadow-xl">
                                Agregar al Carrito üõí
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== CARRITO =====
        function CarritoPage({ carrito, eliminarDelCarrito, handleCheckout, loading, setCurrentPage }) {
            const total = carrito.reduce((sum, item) => sum + item.precioTotal, 0);

            if (carrito.length === 0) {
                return (
                    <div className="text-center py-20">
                        <div className="text-8xl mb-6">üõí</div>
                        <h2 className="text-3xl font-bold mb-4">Tu carrito est√° vac√≠o</h2>
                        <button onClick={() => setCurrentPage('home')} 
                            className="mt-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-full font-bold">
                            Ver Personajes
                        </button>
                    </div>
                );
            }

            return (
                <div className="max-w-5xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold mb-8">Tu Carrito</h1>
                    <div className="bg-white rounded-3xl p-8 shadow-xl">
                        {carrito.map((item, i) => (
                            <div key={i} className="border-b pb-6 mb-6 last:border-0">
                                <div className="flex justify-between">
                                    <div>
                                        <div className="flex items-center gap-3 mb-3">
                                            <span className="text-4xl">{item.personaje.emoji}</span>
                                            <h3 className="text-2xl font-bold">{item.personaje.nombre}</h3>
                                        </div>
                                        <p className="text-gray-600">Tipo: {item.tipoVideo.nombre}</p>
                                        <p className="text-gray-600">Duraci√≥n: {item.duracion.nombre}</p>
                                        <p className="text-gray-600">Entrega: {item.velocidadEntrega.nombre}</p>
                                        <p className="text-gray-500 italic mt-2">"{item.mensaje}"</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-3xl font-bold text-purple-600 mb-3">${item.precioTotal.toFixed(2)}</p>
                                        <button onClick={() => eliminarDelCarrito(i)} 
                                            className="text-red-600 hover:text-red-800">Eliminar</button>
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        <div className="border-t-2 pt-8 flex justify-between items-center">
                            <div>
                                <p className="text-gray-600 mb-2">Total:</p>
                                <p className="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                    ${total.toFixed(2)}
                                </p>
                            </div>
                            <button onClick={handleCheckout} disabled={loading}
                                className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-5 rounded-full text-xl font-bold hover:scale-105 transition disabled:opacity-50 shadow-xl">
                                {loading ? 'Procesando...' : 'Pagar con Stripe üí≥'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== MIS PEDIDOS =====
        function MisPedidosPage({ pedidos, usuario }) {
            if (!usuario) {
                return (
                    <div className="text-center py-20">
                        <p className="text-xl">Inicia sesi√≥n para ver tus pedidos</p>
                    </div>
                );
            }

            if (pedidos.length === 0) {
                return (
                    <div className="text-center py-20">
                        <div className="text-8xl mb-6">üì¶</div>
                        <h2 className="text-3xl font-bold mb-4">No tienes pedidos a√∫n</h2>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold mb-8">Mis Pedidos</h1>
                    <div className="space-y-6">
                        {pedidos.map(pedido => (
                            <div key={pedido.id} className="bg-white rounded-3xl p-8 shadow-xl">
                                <div className="flex justify-between mb-6">
                                    <div>
                                        <h3 className="text-2xl font-bold mb-2">{pedido.personaje_nombre}</h3>
                                        <p className="text-gray-600">{pedido.mensaje_personalizado}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-3xl font-bold text-purple-600">${pedido.precio_total}</p>
                                        <span className={`inline-block px-4 py-2 rounded-full text-sm font-bold mt-2 ${
                                            pedido.estado === 'completado' ? 'bg-green-100 text-green-800' :
                                            pedido.estado === 'pagado' ? 'bg-blue-100 text-blue-800' :
                                            'bg-yellow-100 text-yellow-800'
                                        }`}>
                                            {pedido.estado.toUpperCase()}
                                        </span>
                                    </div>
                                </div>
                                
                                <div className="w-full bg-gray-200 rounded-full h-6">
                                    <div className="bg-gradient-to-r from-purple-600 to-pink-600 h-6 rounded-full transition-all flex items-center justify-center text-white text-sm font-bold"
                                        style={{width: `${pedido.progreso}%`}}>
                                        {pedido.progreso}%
                                    </div>
                                </div>
                                
                                {pedido.video_url && (
                                    <div className="mt-6">
                                        <a href={pedido.video_url} target="_blank" rel="noopener noreferrer"
                                            className="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-full font-bold hover:scale-105 transition">
                                            Ver Mi Video üé¨
                                        </a>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Renderizar
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
