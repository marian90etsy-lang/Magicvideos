<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Videos - Videos Personalizados con IA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.85) 0%, rgba(236, 72, 153, 0.85) 50%, rgba(59, 130, 246, 0.85) 100%);
            z-index: 1;
        }
        
        .video-content {
            position: relative;
            z-index: 2;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .scroll-reviews {
            animation: scroll 60s linear infinite;
        }

        .scroll-reviews:hover {
            animation-play-state: paused;
        }

        .star-filled {
            color: #fbbf24;
        }
        
        .star-empty {
            color: #d1d5db;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ===== CONFIGURACI√ìN =====
        const SUPABASE_URL = 'https://vrhqvjsvqowsxioqusrw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyaHF2anN2cW93c3hpb3F1c3J3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjU3OTAsImV4cCI6MjA3ODYwMTc5MH0.FDSaJ-592b23kxeANFZ49vfP3skIBFv1hO5p9NSUfSE';
        const STRIPE_KEY = 'pk_test_51ST05MLwRYu46TgB8nY7XAlP9JjMTiL6sB8QwkGadNQW3JO2VNjfTUWm4IfG53oRdYYvDvzQRvaf4uBTBFb8Yyl000cjCYqRJR';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const stripe = Stripe(STRIPE_KEY);

        // ===== DATOS =====
        const personajes = [
            { 
                id: 1, 
                nombre: 'Bluey', 
                imagen: 'IMAGEN_BLUEY.png',
                precio: 29.99, 
                descripcion: 'Un perrito azul lleno de energ√≠a y creatividad que ama jugar y aprender. Bluey hace que cada d√≠a sea una aventura emocionante llena de risas, juegos y valiosas lecciones. Con su imaginaci√≥n sin l√≠mites, transforma momentos ordinarios en experiencias m√°gicas que ense√±an sobre la amistad, la familia y el valor de ser uno mismo.',
                videoDemo: 'VIDEO_DESCRIPCION_BLUEY.mp4',
                reviews: [
                    { nombre: 'Mar√≠a Gonz√°lez', calificacion: 5, comentario: '¬°Mi hija est√° obsesionada con Bluey y este video la hizo llorar de felicidad! La calidad es incre√≠ble.', fecha: '2025-11-10' },
                    { nombre: 'Carlos Mart√≠nez', calificacion: 5, comentario: 'Excelente trabajo, el video captura perfectamente la esencia de Bluey. Mi hijo no para de verlo.', fecha: '2025-11-09' },
                    { nombre: 'Ana Rodr√≠guez', calificacion: 5, comentario: 'S√∫per recomendado, la personalizaci√≥n fue perfecta. Vale cada centavo.', fecha: '2025-11-08' }
                ]
            },
            { 
                id: 2, 
                nombre: 'Elfo Travieso', 
                imagen: 'ELFO_TRAVIESO.png',
                precio: 34.99, 
                descripcion: 'Un elfo navide√±o lleno de travesuras y magia que trae la alegr√≠a de la Navidad a tu hogar. Este simp√°tico ayudante de Santa Claus crea momentos m√°gicos cada d√≠a de diciembre, dejando sorpresas y risas por toda la casa. Con su esp√≠ritu juguet√≥n y su misi√≥n especial de reportar a Santa, hace que cada ma√±ana sea emocionante mientras cuenta los d√≠as hasta la Navidad.',
                videoDemo: 'VIDEO_ELFO_TRAVIESO.mp4',
                reviews: [
                    { nombre: 'Patricia L√≥pez', calificacion: 5, comentario: '¬°Perfecto para la temporada navide√±a! Mi familia entera est√° encantada con el video.', fecha: '2025-11-12' },
                    { nombre: 'Roberto Silva', calificacion: 5, comentario: 'La magia navide√±a cobra vida con este video. Los ni√±os est√°n fascinados.', fecha: '2025-11-11' },
                    { nombre: 'Laura Fern√°ndez', calificacion: 5, comentario: 'Incre√≠ble atenci√≥n al detalle. El Elfo Travieso nunca se vio tan real.', fecha: '2025-11-10' }
                ]
            }
        ];

        // ===== COMPONENTES AUXILIARES =====
        function StarRating({ rating }) {
            return (
                <div className="flex items-center">
                    {[...Array(5)].map((_, i) => (
                        <span key={i} className={`text-xl ${i < rating ? 'star-filled' : 'star-empty'}`}>‚òÖ</span>
                    ))}
                </div>
            );
        }

        // ===== MODAL LOGIN =====
        function LoginModal({ isOpen, onClose, onLoginSuccess }) {
            const [mode, setMode] = useState('login');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [nombre, setNombre] = useState('');
            const [loading, setLoading] = useState(false);
            const [mensaje, setMensaje] = useState('');

            if (!isOpen) return null;

            const handleGoogleLogin = async () => {
                try {
                    const { error } = await supabase.auth.signInWithOAuth({
                        provider: 'google',
                        options: { redirectTo: window.location.origin }
                    });
                    if (error) throw error;
                } catch (error) {
                    setMensaje('Error: ' + error.message);
                }
            };

            const handleEmailLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setMensaje('');
                
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                    if (error) throw error;
                    setMensaje('¬°Inicio de sesi√≥n exitoso!');
                    setTimeout(() => {
                        onLoginSuccess();
                        onClose();
                    }, 1000);
                } catch (error) {
                    setMensaje('Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                setLoading(true);
                setMensaje('');
                
                try {
                    const { data, error } = await supabase.auth.signUp({
                        email,
                        password,
                        options: { data: { full_name: nombre } }
                    });
                    if (error) throw error;
                    setMensaje('¬°Registro exitoso! Revisa tu email.');
                    setTimeout(() => setMode('login'), 2000);
                } catch (error) {
                    setMensaje('Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="modal-backdrop" onClick={onClose}>
                    <div className="bg-white rounded-3xl p-8 max-w-md w-full mx-4 shadow-2xl" onClick={(e) => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                {mode === 'login' ? 'Iniciar Sesi√≥n' : 'Registrarse'}
                            </h2>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                        </div>

                        <button onClick={handleGoogleLogin}
                            className="w-full bg-white border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:bg-gray-50 transition mb-6 flex items-center justify-center gap-3">
                            <svg className="w-6 h-6" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Continuar con Google
                        </button>

                        <div className="relative mb-6">
                            <div className="absolute inset-0 flex items-center">
                                <div className="w-full border-t border-gray-300"></div>
                            </div>
                            <div className="relative flex justify-center text-sm">
                                <span className="px-2 bg-white text-gray-500">O</span>
                            </div>
                        </div>

                        {mode === 'login' ? (
                            <form onSubmit={handleEmailLogin}>
                                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)}
                                    placeholder="Email" required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-600 focus:outline-none" />
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Contrase√±a" required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-600 focus:outline-none" />
                                <button type="submit" disabled={loading}
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transition disabled:opacity-50">
                                    {loading ? 'Iniciando...' : 'Iniciar Sesi√≥n'}
                                </button>
                                <p className="mt-4 text-center text-sm text-gray-600">
                                    ¬øNo tienes cuenta? <button type="button" onClick={() => setMode('register')} className="text-purple-600 hover:underline font-semibold">Reg√≠strate</button>
                                </p>
                            </form>
                        ) : (
                            <form onSubmit={handleRegister}>
                                <input type="text" value={nombre} onChange={(e) => setNombre(e.target.value)}
                                    placeholder="Nombre completo" required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-600 focus:outline-none" />
                                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)}
                                    placeholder="Email" required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-600 focus:outline-none" />
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required minLength="6"
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-600 focus:outline-none" />
                                <button type="submit" disabled={loading}
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transition disabled:opacity-50">
                                    {loading ? 'Registrando...' : 'Crear Cuenta'}
                                </button>
                                <p className="mt-4 text-center text-sm text-gray-600">
                                    ¬øYa tienes cuenta? <button type="button" onClick={() => setMode('login')} className="text-purple-600 hover:underline font-semibold">Inicia sesi√≥n</button>
                                </p>
                            </form>
                        )}

                        {mensaje && (
                            <div className={`mt-4 p-4 rounded-xl ${mensaje.includes('Error') ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>
                                {mensaje}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ===== HEADER =====
        function Header({ usuario, onLoginClick, onLogout, carrito, setCurrentPage }) {
            return (
                <header className="bg-white shadow-md sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                        <button onClick={() => setCurrentPage('home')} className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                            Magic Videos ‚ú®
                        </button>
                        <div className="flex items-center space-x-6">
                            {usuario ? (
                                <>
                                    <button onClick={() => setCurrentPage('dashboard')} className="font-semibold hover:text-purple-600 transition">
                                        Dashboard
                                    </button>
                                    <button onClick={() => setCurrentPage('carrito')} className="relative">
                                        <span className="text-2xl">üõí</span>
                                        {carrito.length > 0 && <span className="cart-badge">{carrito.length}</span>}
                                    </button>
                                    <button onClick={onLogout} className="bg-red-500 text-white px-4 py-2 rounded-full font-semibold hover:bg-red-600 transition">
                                        Salir
                                    </button>
                                </>
                            ) : (
                                <button onClick={onLoginClick} className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full font-semibold hover:scale-105 transition">
                                    Iniciar Sesi√≥n
                                </button>
                            )}
                        </div>
                    </div>
                </header>
            );
        }

        // ===== HOME PAGE =====
        function HomePage({ verPersonaje }) {
            return (
                <div>
                    {/* Hero con video de fondo */}
                    <section className="relative h-screen flex items-center justify-center overflow-hidden">
                        <video autoPlay loop muted playsInline className="video-background">
                            <source src="Avatar_IV_Video.mp4" type="video/mp4" />
                        </video>
                        <div className="video-overlay"></div>
                        <div className="video-content text-center px-4 fade-in">
                            <h1 className="text-5xl md:text-7xl font-bold text-white mb-6">
                                Videos M√°gicos Para<br />Momentos Especiales
                            </h1>
                            <p className="text-xl md:text-2xl text-white mb-8 max-w-2xl mx-auto">
                                Videos personalizados √∫nicos con tus personajes favoritos
                            </p>
                            <button onClick={() => window.scrollTo({ top: window.innerHeight, behavior: 'smooth' })} 
                                className="bg-white text-purple-600 px-8 py-4 rounded-full text-lg font-bold hover:scale-110 transform transition shadow-2xl">
                                Explorar Personajes ‚ú®
                            </button>
                        </div>
                    </section>

                    {/* Personajes */}
                    <section className="py-16 px-4 bg-white">
                        <div className="max-w-7xl mx-auto">
                            <h2 className="text-4xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                Nuestros Personajes
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                                {personajes.map(personaje => (
                                    <div key={personaje.id} onClick={() => verPersonaje(personaje)}
                                        className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-6 shadow-xl hover:scale-105 transition-transform cursor-pointer">
                                        <img src={personaje.imagen} alt={personaje.nombre} className="w-full h-64 object-cover rounded-2xl mb-4" />
                                        <h3 className="text-2xl font-bold mb-2">{personaje.nombre}</h3>
                                        <p className="text-gray-600 mb-4">{personaje.descripcion.substring(0, 100)}...</p>
                                        <div className="flex justify-between items-center">
                                            <span className="text-3xl font-bold text-purple-600">${personaje.precio}</span>
                                            <button className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full font-bold hover:shadow-lg transition">
                                                Ver M√°s
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>
                </div>
            );
        }

        // ===== P√ÅGINA DE PERSONAJE =====
        function PersonajePage({ personaje, agregarAlCarrito, usuario, onLoginClick }) {
            const [mensaje, setMensaje] = useState('');

            if (!personaje) return null;

            const handleAgregar = () => {
                if (!usuario) {
                    alert('Debes iniciar sesi√≥n para agregar al carrito');
                    onLoginClick();
                    return;
                }
                if (!mensaje.trim()) {
                    alert('Por favor escribe un mensaje');
                    return;
                }
                agregarAlCarrito({
                    personaje,
                    mensaje,
                    precioBase: personaje.precio,
                    precioTotal: personaje.precio
                });
            };

            return (
                <div className="max-w-7xl mx-auto px-4 py-12">
                    <div className="grid md:grid-cols-2 gap-12 mb-12">
                        {/* Video Demo */}
                        <div>
                            <div className="bg-black rounded-3xl overflow-hidden shadow-2xl mb-6">
                                <video controls className="w-full">
                                    <source src={personaje.videoDemo} type="video/mp4" />
                                </video>
                            </div>
                            <div className="bg-white rounded-2xl p-6 shadow-lg">
                                <h1 className="text-4xl font-bold mb-4">{personaje.nombre}</h1>
                                <p className="text-gray-600 mb-6 text-lg">{personaje.descripcion}</p>
                                
                                <div className="bg-blue-50 rounded-xl p-4 mb-6">
                                    <p className="text-sm text-blue-800 font-semibold mb-2">‚è±Ô∏è Tiempo de Entrega</p>
                                    <p className="text-blue-700">Tu video estar√° listo en <span className="font-bold">48-72 horas</span></p>
                                </div>

                                <div className="flex items-center justify-between">
                                    <span className="text-4xl font-bold text-purple-600">${personaje.precio}</span>
                                </div>
                            </div>
                        </div>

                        {/* Formulario */}
                        <div className="bg-white rounded-3xl p-8 shadow-xl">
                            <h2 className="text-3xl font-bold mb-6">Personaliza Tu Video</h2>
                            
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">Tu Mensaje Personalizado</h3>
                                <textarea 
                                    value={mensaje} 
                                    onChange={(e) => setMensaje(e.target.value)}
                                    className="w-full p-4 border-2 border-gray-200 rounded-xl resize-none focus:border-purple-600 focus:outline-none"
                                    rows="10" 
                                    placeholder="Escribe aqu√≠ tu mensaje especial..."
                                />
                            </div>

                            <button onClick={handleAgregar}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-xl font-bold hover:scale-105 transition shadow-xl">
                                Agregar al Carrito üõí
                            </button>
                        </div>
                    </div>

                    {/* Carrusel de Reviews */}
                    <div className="bg-white rounded-3xl p-8 shadow-xl">
                        <h2 className="text-3xl font-bold mb-8 text-center">Lo que dicen nuestros clientes</h2>
                        <div className="overflow-hidden">
                            <div className="flex scroll-reviews gap-6">
                                {[...personaje.reviews, ...personaje.reviews].map((review, index) => (
                                    <div key={index} className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 min-w-[350px] max-w-[350px]">
                                        <div className="flex items-center justify-between mb-4">
                                            <div>
                                                <p className="font-bold">{review.nombre}</p>
                                                <p className="text-sm text-gray-600">{review.fecha}</p>
                                            </div>
                                            <StarRating rating={review.calificacion} />
                                        </div>
                                        <p className="text-gray-700 italic">"{review.comentario}"</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== CARRITO =====
        function CarritoPage({ carrito, eliminarDelCarrito, handleCheckout, loading, setCurrentPage }) {
            if (carrito.length === 0) {
                return (
                    <div className="text-center py-20">
                        <div className="text-8xl mb-6">üõí</div>
                        <h2 className="text-3xl font-bold mb-4">Tu carrito est√° vac√≠o</h2>
                        <button onClick={() => setCurrentPage('home')} 
                            className="mt-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-full font-bold hover:scale-105 transition">
                            Ver Personajes
                        </button>
                    </div>
                );
            }

            const total = carrito.reduce((sum, item) => sum + item.precioTotal, 0);

            return (
                <div className="max-w-5xl mx-auto px-4 py-12">
                    <h1 className="text-4xl font-bold mb-8">Tu Carrito</h1>
                    <div className="bg-white rounded-3xl p-8 shadow-xl">
                        {carrito.map((item, i) => (
                            <div key={i} className="border-b-2 pb-6 mb-6 last:border-0">
                                <div className="flex justify-between">
                                    <div className="flex-1">
                                        <h3 className="text-2xl font-bold mb-2">{item.personaje.nombre}</h3>
                                        <p className="text-gray-500 italic">"{item.mensaje}"</p>
                                    </div>
                                    <div className="text-right ml-6">
                                        <p className="text-3xl font-bold text-purple-600 mb-3">${item.precioTotal.toFixed(2)}</p>
                                        <button onClick={() => eliminarDelCarrito(i)} 
                                            className="text-red-600 hover:text-red-800 font-semibold transition">
                                            Eliminar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        <div className="border-t-2 pt-6">
                            <div className="flex justify-between items-center mb-6">
                                <span className="text-2xl font-bold">TOTAL:</span>
                                <span className="text-4xl font-bold text-purple-600">${total.toFixed(2)}</span>
                            </div>
                            <button onClick={handleCheckout} disabled={loading}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-xl font-bold hover:scale-105 transition shadow-xl disabled:opacity-50">
                                {loading ? 'Procesando...' : 'Pagar con Stripe üí≥'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== APP PRINCIPAL =====
        function App() {
            const [usuario, setUsuario] = useState(null);
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedPersonaje, setSelectedPersonaje] = useState(null);
            const [carrito, setCarrito] = useState([]);
            const [loading, setLoading] = useState(false);
            const [showLoginModal, setShowLoginModal] = useState(false);

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUsuario(session?.user ?? null);
                });

                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setUsuario(session?.user ?? null);
                });

                return () => subscription.unsubscribe();
            }, []);

            const verPersonaje = (personaje) => {
                setSelectedPersonaje(personaje);
                setCurrentPage('personaje');
            };

            const agregarAlCarrito = (item) => {
                setCarrito([...carrito, item]);
                alert('¬°Agregado al carrito!');
                setCurrentPage('carrito');
            };

            const eliminarDelCarrito = (index) => {
                setCarrito(carrito.filter((_, i) => i !== index));
            };

            const handleCheckout = async () => {
                if (!usuario) {
                    alert('Debes iniciar sesi√≥n');
                    setShowLoginModal(true);
                    return;
                }

                try {
                    setLoading(true);
                    const response = await fetch('/api/checkout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ carrito, usuario })
                    });
                    const data = await response.json();
                    if (data.error) throw new Error(data.error);
                    window.location.href = data.url;
                } catch (error) {
                    alert('Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = async () => {
                await supabase.auth.signOut();
                setUsuario(null);
                setCarrito([]);
                setCurrentPage('home');
            };

            const handleLoginClick = () => {
                setShowLoginModal(true);
            };

            const handleLoginSuccess = () => {
                setShowLoginModal(false);
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    <Header 
                        usuario={usuario} 
                        onLoginClick={handleLoginClick}
                        onLogout={handleLogout}
                        carrito={carrito}
                        setCurrentPage={setCurrentPage}
                    />
                    <main>
                        {currentPage === 'home' && <HomePage verPersonaje={verPersonaje} />}
                        {currentPage === 'personaje' && <PersonajePage personaje={selectedPersonaje} agregarAlCarrito={agregarAlCarrito} usuario={usuario} onLoginClick={handleLoginClick} />}
                        {currentPage === 'carrito' && <CarritoPage carrito={carrito} eliminarDelCarrito={eliminarDelCarrito} handleCheckout={handleCheckout} loading={loading} setCurrentPage={setCurrentPage} />}
                    </main>

                    <LoginModal 
                        isOpen={showLoginModal} 
                        onClose={() => setShowLoginModal(false)}
                        onLoginSuccess={handleLoginSuccess}
                    />
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
